{"version":3,"sources":["components/discordLogin.tsx","components/itemSelector/itemSelector.tsx","components/itemRow.tsx","models.tsx","util.tsx","pages/priorityManagementPage.tsx","components/itemSelector/itemProvider.tsx","context.tsx","api.tsx","components/priorityValidators.tsx","components/selectedItems.tsx","components/header.tsx","app.tsx","index.tsx"],"names":["styled","a","img","AutoSuggest","onChangeDebounced","debounce","props","this","onChange","event","persist","React","Component","ItemSelector","state","disabled","searching","currentResults","searchText","wrapperRef","setWrapperRef","node","handleClickOutside","contains","target","reset","itemProvider","abort","search","value","filter","length","setState","getItems","document","addEventListener","removeEventListener","ref","className","placeholder","items","onClick","item","onItemSelected","resetOnSelection","Result","div","ResultWrap","Results","map","tiers","name","type","slot","Raid","ItemRow","onDelete","TierBubble","color","ItemTiers","t","SetupState","APIItemProvider","api","searchItems","results","APIContext","createContext","apiRoot","getPriority","fetch","redirect","mode","credentials","result","status","Error","json","updatePriority","itemIds","method","headers","body","JSON","stringify","process","tierValidator","rule","isValid","tiersSeen","Map","forEach","i","set","id","get","Array","from","values","v","naxxValidator","zone","NAXX","PriorityValidatorMessage","valid","validator","undefined","dangerouslySetInnerHTML","__html","SelectedItems","array","prop","max","groupedSelectedItems","selected","reduce","groups","val","push","useContext","validators","find","onAddNew","concat","Object","keys","BWL","MC","ONY","ZG","formatZone","newItems","onChangeSelection","Header","PriorityManagementPage","Page","setupState","None","priority","saveEnabled","saveButtonText","savePopup","setup","Fetching","priorityPage","pi","Success","isFetching","isError","isSuccess","addNewItem","saveButtonTimeout","setSaveButton","text","clearTimeout","setTimeout","save","classList","add","remove","message","newSelections","el","App","console","log","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.142c8db0.chunk.js","sourcesContent":["import React from \"react\";\nimport styled from \"styled-components\";\n//import discordIcon from \"../images/discord-white.svg\";\n\nconst ButtonWrap = styled.a`\n  display: inline-flex;\n  align-items: center;\n  padding: 10px 20px 10px 10px;\n  font-size: 45px;\n  background-color: #7289da;\n  border-radius: 5px;\n  color: #fff;\n  cursor: pointer;\n`;\nconst IconWrap = styled.img`\n  height: 80px;\n  margin-right: 10px;\n`;\nconst DiscordIcon = () => {\n  return null; //return <IconWrap src={discordIcon} alt=\"discord logo\" />;\n};\n\nexport const DiscordLoginButton = () => (\n  <ButtonWrap>\n    <DiscordIcon />\n    Login with Discord\n  </ButtonWrap>\n);\n","import React, {\n  FC,\n  DetailedHTMLProps,\n  ChangeEvent,\n  useRef,\n  useState,\n} from \"react\";\nimport { ItemProvider } from \"./itemProvider\";\nimport { debounce } from \"ts-debounce\";\nimport { Item } from \"../../models\";\nimport styled from \"styled-components\";\nimport { ItemTiers } from \"..\";\n\ntype AutoSuggestProps = React.DetailedHTMLProps<\n  React.InputHTMLAttributes<HTMLInputElement>,\n  HTMLInputElement\n>;\n\nclass AutoSuggest extends React.Component<\n  AutoSuggestProps & {\n    onChangeDebounced: (event: ChangeEvent<HTMLInputElement>) => void;\n  }\n> {\n  private onChangeDebounced = debounce(this.props.onChangeDebounced, 300);\n\n  render() {\n    return (\n      <input\n        {...this.props}\n        onChange={(event: ChangeEvent<HTMLInputElement>) => {\n          event.persist();\n          this.props.onChange && this.props.onChange(event);\n          this.onChangeDebounced(event);\n        }}\n      />\n    );\n  }\n}\n\nexport interface ItemSelectorProps {\n  itemProvider: ItemProvider;\n  resetOnSelection?: boolean;\n  onItemSelected: (item: Item) => void;\n}\n\ninterface ItemSelectorState {\n  searching: boolean;\n  disabled: boolean;\n  currentResults: Array<Item>;\n  searchText: string;\n}\n\nexport class ItemSelector extends React.Component<\n  ItemSelectorProps,\n  ItemSelectorState\n> {\n  state: ItemSelectorState = {\n    disabled: false,\n    searching: false,\n    currentResults: [],\n    searchText: \"\",\n  };\n  wrapperRef?: HTMLDivElement;\n\n  componentDidMount() {\n    document.addEventListener(\"mousedown\", this.handleClickOutside);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"mousedown\", this.handleClickOutside);\n  }\n\n  /**\n   * Set the wrapper ref\n   */\n  setWrapperRef = (node: HTMLDivElement) => {\n    this.wrapperRef = node;\n  };\n\n  /**\n   * Alert if clicked on outside of element\n   */\n  handleClickOutside = (event: any) => {\n    if (this.wrapperRef && !this.wrapperRef.contains(event.target)) {\n      this.reset();\n      this.props.itemProvider.abort();\n    }\n  };\n\n  onChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.search(event.target.value);\n  };\n\n  search = async (filter: string) => {\n    this.props.itemProvider.abort();\n    if (filter.length < 3) {\n      this.setState({\n        searching: false,\n        disabled: false,\n        currentResults: [],\n      });\n      return;\n    }\n    this.setState({\n      searching: true,\n    });\n    try {\n      this.setState({\n        currentResults: await this.props.itemProvider.getItems(filter),\n      });\n    } finally {\n      this.setState({\n        searching: false,\n        disabled: false,\n      });\n    }\n  };\n\n  reset = () => {\n    this.setState({\n      currentResults: [],\n      searchText: \"\",\n    });\n  };\n\n  render() {\n    return (\n      <div ref={this.setWrapperRef} className=\"item-selector\">\n        <AutoSuggest\n          value={this.state.searchText}\n          className=\"auto-suggest big\"\n          placeholder=\"Search for items...\"\n          onChange={(event: ChangeEvent<HTMLInputElement>) => {\n            this.setState({ disabled: true, searchText: event.target.value });\n          }}\n          onChangeDebounced={this.onChange}\n        />\n        {this.state.currentResults.length > 0 && (\n          <Results\n            disabled={this.state.disabled}\n            items={this.state.currentResults}\n            onClick={(item) => {\n              this.props.onItemSelected(item);\n              if (this.props.resetOnSelection) {\n                this.reset();\n              }\n            }}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nconst Result = styled.div`\n  cursor: pointer;\n  padding: 10px;\n  border-bottom: 1px solid #eee;\n  &:hover {\n    background-color: #eee;\n  }\n`;\n\nconst ResultWrap = styled.div<{ disabled: boolean }>`\n  pointerevents: ${(props) => (props.disabled ? \"none\" : \"inherit\")};\n  ${Result} {\n    opacity: ${(props) => (props.disabled ? 0.5 : 1)};\n  }\n`;\n\ninterface ResultsProps {\n  items: Array<Item>;\n  disabled: boolean;\n  onClick: (item: Item) => void;\n}\n\nconst Results = (props: ResultsProps) => {\n  return (\n    <ResultWrap className=\"result-wrap\" disabled={props.disabled}>\n      {props.items.map((item: Item) => (\n        <Result className=\"result\" onClick={() => props.onClick(item)}>\n          <ItemTiers tiers={item.tiers} />\n          <div className=\"name\">{item.name}</div>\n          <div className=\"type\">{item.type}</div>\n          <div className=\"slot\">{item.slot}</div>\n        </Result>\n      ))}\n    </ResultWrap>\n  );\n};\n","import React from \"react\";\nimport { Item, ItemTier } from \"../models\";\nimport styled from \"styled-components\";\n\nexport interface ItemRowProps {\n  item: Item;\n  onDelete: () => void;\n}\n\nexport const ItemRow = (props: ItemRowProps) => {\n  return (\n    <div className=\"item-row\">\n      <ItemTiers tiers={props.item.tiers} />\n      <div className=\"name\">{props.item.name}</div>\n      <div className=\"type\">{props.item.type}</div>\n\n      <div className=\"item-action\">\n        <div className=\"button delete\" onClick={props.onDelete}>\n          delete\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst TierBubble = styled.div<{ color: string }>`\n  background-color: ${props => props.color}\n`;\n\nexport const ItemTiers = (props: { tiers: Array<ItemTier> }) => {\n  const { tiers } = props;\n  if(tiers?.length) {\n    return (\n      <div className='tiers'>\n        {tiers.map(t => <TierBubble className='tier' color={t.color}>{t.name}</TierBubble>)}\n      </div>\n    )\n  }else{\n    return null;\n  }\n}","export enum Raid {\n  MC = \"MC\",\n  BWL = \"BWL\",\n  AQ_40 = \"AQ40\",\n  ZG = \"ZG\",\n  ONY = \"ONY\",\n  NAXX = \"NAXX\"\n}\n\nexport interface PriorityItem {\n  id: number;\n  added: string;\n  updated: string;\n  item: Item;\n}\n\nexport interface Item {\n  id: number;\n  zone: Raid;\n  name: string;\n  type: string;\n  slot: string;\n  tiers: Array<ItemTier>;\n}\n\nexport interface ItemTier {\n  id: number;\n  name: string;\n  color: string;\n}","import { Raid } from \"./models\";\n\nexport function groupBy<T>(\n  array: Array<T>,\n  prop: string\n): { [key: string]: Array<T> } {\n  return array.reduce(function(groups: { [key: string]: Array<T> }, item: any) {\n    const val = item[prop];\n    groups[val] = groups[val] || [];\n    groups[val].push(item);\n    return groups;\n  }, {});\n}\n\nexport const formatZone = (zone: Raid) => {\n  switch (zone) {\n    case Raid.BWL:\n      return \"Blackwing Lair\";\n    case Raid.MC:\n      return \"Molten Core\";\n    case Raid.ONY:\n      return \"Onyxia\";\n    case Raid.ZG:\n      return \"Zul'gurub\";\n    case Raid.NAXX:\n      return \"Naxx\";\n  }\n\n  return zone;\n};\n","import React, { useContext, FC } from \"react\";\nimport { APIContext } from \"../context\";\nimport { API } from \"../api\";\nimport { Item } from \"../models\";\nimport { SelectedItems } from \"../components\";\n\nexport const PriorityManagementPage: FC = () => {\n  const api = useContext(APIContext);\n\n  return <Page api={api} />;\n};\n\ninterface PageProps {\n  api: API;\n}\n\nenum SetupState {\n  None,\n  Fetching,\n  Success,\n  Error,\n}\n\ninterface PageState {\n  setupState: SetupState;\n  priority: Array<Item>;\n  saveEnabled: boolean;\n  saveButtonText: string;\n}\n\nclass Page extends React.Component<PageProps, PageState> {\n  state = {\n    setupState: SetupState.None,\n    priority: [],\n    saveEnabled: false,\n    saveButtonText: \"Save Changes\",\n  } as PageState;\n\n  private savePopup: HTMLDivElement | null = null;\n  componentDidMount() {\n    this.setup();\n  }\n\n  setup = async () => {\n    this.setState({\n      setupState: SetupState.Fetching,\n    });\n    const { api } = this.props;\n\n    try {\n      const priorityPage = await api.getPriority();\n      this.setState({\n        priority: priorityPage.results.map((pi) => pi.item),\n        setupState: SetupState.Success,\n      });\n    } catch {\n      this.setState({\n        setupState: SetupState.Error,\n      });\n    }\n  };\n\n  private isFetching = () => this.state.setupState == SetupState.Fetching;\n  private isError = () => this.state.setupState == SetupState.Error;\n  private isSuccess = () => this.state.setupState == SetupState.Success;\n\n  addNewItem = (item: Item, isValid: boolean) => {\n    if (!!this.state.priority.find((i) => i.id == item.id)) return;\n\n    this.setState({\n      priority: this.state.priority.concat(item),\n      saveEnabled: isValid,\n    });\n  };\n\n  private saveButtonTimeout?: number;\n  setSaveButton = (text: string) => {\n    clearTimeout(this.saveButtonTimeout);\n    this.setState({\n      saveButtonText: text,\n    });\n\n    this.saveButtonTimeout = setTimeout(() => {\n      this.setState({\n        saveButtonText: \"Save Changes\",\n      });\n    }, 3000);\n  };\n\n  save = async () => {\n    if (!this.state.saveEnabled) return;\n\n    try {\n      await this.props.api.updatePriority(this.state.priority.map((i) => i.id));\n      this.setSaveButton(\"Save Successful!\");\n      if (this.savePopup) {\n        this.savePopup.classList.add(\"save-animate\");\n        setTimeout(() => {\n          this.savePopup!.classList.remove(\"save-animate\");\n        }, 4000);\n      }\n    } catch (exc) {\n      this.setSaveButton(\"Error Saving: \" + exc.message);\n    }\n  };\n\n  render() {\n    return (\n      <div>\n        <h1>Priority Management</h1>\n\n        {this.isFetching() && <div>Fetching priority...</div>}\n        {this.isError() && (\n          <div>Error getting priority items. Try to refresh the page.</div>\n        )}\n        {this.isSuccess() && (\n          <div className=\"selected-item-wrap\">\n            <SelectedItems\n              max={6}\n              selected={this.state.priority}\n              onAddNew={this.addNewItem}\n              onChangeSelection={(newSelections, isValid) =>\n                this.setState({ priority: newSelections, saveEnabled: isValid })\n              }\n            />\n            <div className=\"spacer\"></div>\n            <div\n              className={\n                \"button save-prio big centered \" +\n                (this.state.saveEnabled ? \"\" : \"disabled\")\n              }\n              onClick={this.save}\n            >\n              {this.state.saveButtonText}\n            </div>\n          </div>\n        )}\n        <div ref={(el) => (this.savePopup = el)} className=\"oops-mindslayers\"></div>\n      </div>\n    );\n  }\n}\n","import { Item, Raid } from \"../../models\";\nimport { API } from \"../../api\";\n\nexport interface ItemProvider {\n  getItems: (name: string) => Promise<Array<Item>>;\n  abort: () => void;\n}\n\nexport class APIItemProvider implements ItemProvider {\n  private api: API;\n  constructor(api: API) {\n    this.api = api;\n  }\n  getItems = async (name: string): Promise<Item[]> => {\n    const items = await this.api.searchItems(name);\n    return items.results;\n  };\n  abort = () => {};\n}\n","import React from \"react\";\nimport { API } from \"./api\";\n\nexport const APIContext = React.createContext(\n  new API(process.env.REACT_APP_API_ROOT!)\n);\n","import { Item, PriorityItem } from \"./models\";\n\ninterface ItemResult<T> {\n  count: number;\n  next?: string;\n  previous?: string;\n  results: Array<T>;\n}\n\nexport class API {\n  private apiRoot: string;\n  constructor(apiRoot: string) {\n    this.apiRoot = apiRoot;\n  }\n\n  getPriority = async () => {\n    const result = await fetch(`${this.apiRoot}priorities/`, {\n      redirect: \"follow\",\n      mode: \"cors\",\n      credentials: \"include\",\n    });\n    if (result.status !== 200) {\n      throw new Error(\"Error getting priority\");\n    }\n    return (await result.json()) as ItemResult<PriorityItem>;\n  };\n\n  updatePriority = async (itemIds: Array<number>) => {\n    const result = await fetch(`${this.apiRoot}priorities/bulk_update/`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        // 'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      redirect: \"follow\",\n      mode: \"cors\",\n      credentials: \"include\",\n      body: JSON.stringify({ items: itemIds }),\n    });\n    if (result.status == 400) {\n      throw new Error((await result.json())[\"non_field_errors\"]);\n    }\n    if (result.status !== 201) {\n      throw new Error(\"generic error updating priority\");\n    }\n  };\n\n  searchItems = async (filter: string) => {\n    const result = await fetch(`${this.apiRoot}items/?search=${filter}`, {\n      redirect: \"follow\",\n      mode: \"cors\",\n      credentials: \"include\",\n    });\n    if (result.status !== 200) {\n      throw new Error(\"Error getting items\");\n    }\n    return (await result.json()) as ItemResult<Item>;\n  };\n}\n","import React from \"react\";\nimport { Item, Raid } from \"../models\";\n\nexport interface ItemValidator {\n  rule: string;\n  isValid: (items: Array<Item>) => boolean;\n}\n\nexport const maxValidator = (max: number) => {\n  return {\n    rule: `Up to ${max} items total`,\n    isValid: (items: Array<Item>) => {\n      return items.length <= max;\n    },\n  };\n};\n\nexport const tierValidator = {\n  rule: \"Up to  1 item from each tier <a target='_blank' class='tier-link' href='https://docs.google.com/spreadsheets/d/1FbMklpoZPyJFXT4V1797OHIEoyPLk8Z9T3iD_n99VSU/edit#gid=0'>(view tier lists)</a>\",\n  isValid: (items: Array<Item>) => {\n    const tiersSeen = new Map<number, number>();\n    items.forEach(i => i.tiers.forEach(t => {\n      tiersSeen.set(t.id, (tiersSeen.get(t.id) || 0)+1)\n    }))\n\n    return (\n      Array.from(tiersSeen.values()).filter(v => v > 1).length == 0\n    );\n  }\n}\n\nexport const mcValidator = {\n  rule: \"Up to 3 items from Molten Core or Onyxia\",\n  isValid: (items: Array<Item>) => {\n    return (\n      items.filter((i) => i.zone == Raid.MC || i.zone == Raid.ONY).length <= 3\n    );\n  },\n};\n\nexport const bwlValidator = {\n  rule: \"Up to 3 items from Blackwing Lair\",\n  isValid: (items: Array<Item>) => {\n    return items.filter((i) => i.zone == Raid.BWL).length <= 3;\n  },\n};\n\nexport const aq40Validator = {\n  rule: \"Up to 3 items from AQ40\",\n  isValid: (items: Array<Item>) => {\n    return items.filter((i) => i.zone == Raid.AQ_40).length <= 3;\n  },\n};\n\nexport const naxxValidator = {\n  rule: \"Up to 3 items from Naxx\",\n  isValid: (items: Array<Item>) => {\n    return items.filter((i) => i.zone == Raid.NAXX).length <= 3;\n  },\n}\n\nexport const otherValidator = {\n  rule: \"Optional: Fill remaining slots with other raids\",\n  isValid: (items: Array<Item>) => {\n    return true;\n  },\n};\n\nexport const PriorityValidatorMessage = (props: {\n  validator: ItemValidator;\n  items: Array<Item>;\n}) => {\n  const valid = props.validator.isValid(props.items);\n  return (\n    <span className={valid ? undefined : \"invalid\"} dangerouslySetInnerHTML={{ __html: props.validator.rule }}></span>\n  );\n};\n","import React, { useState, useContext } from \"react\";\nimport { Item, Raid } from \"../models\";\nimport { ItemRow } from \"./itemRow\";\nimport { groupBy, formatZone } from \"../util\";\nimport { ItemSelector } from \"./itemSelector\";\nimport { APIItemProvider } from \"./itemSelector/itemProvider\";\nimport { APIContext } from \"../context\";\nimport {\n  maxValidator,\n  mcValidator,\n  bwlValidator,\n  aq40Validator,\n  otherValidator,\n  tierValidator,\n  PriorityValidatorMessage,\n  naxxValidator,\n} from \"./priorityValidators\";\n\nexport interface SelectedItemsProps {\n  selected: Array<Item>;\n  max: number;\n  onChangeSelection: (newItems: Array<Item>, isValid: boolean) => void;\n  onAddNew: (item: Item, isValid: boolean) => void;\n}\n\nexport const SelectedItems = (props: SelectedItemsProps) => {\n  const groupedSelectedItems = groupBy(props.selected, \"zone\");\n  const api = useContext(APIContext);\n\n  const validators = [\n    maxValidator(6),\n    tierValidator,\n    naxxValidator,\n    //otherValidator,\n  ];\n\n  return (\n    <div className=\"selected-items\">\n      <div className=\"selected-items-instructions\">\n        <span>Priority list rules:</span>\n        <ul>\n          {validators.map((v) => (\n            <li>\n              <PriorityValidatorMessage validator={v} items={props.selected} />\n            </li>\n          ))}\n        </ul>\n      </div>\n\n      <ItemSelector\n        resetOnSelection\n        itemProvider={new APIItemProvider(api)}\n        onItemSelected={(item: Item) => {\n          if (!!props.selected.find((i) => i.id == item.id)) return;\n\n          props.onAddNew(\n            item,\n            validators.reduce(\n              (valid: boolean, validator) =>\n                valid && validator.isValid(props.selected.concat(item)),\n              true\n            )\n          );\n        }}\n      />\n\n      {Object.keys(groupedSelectedItems).map((zone) => {\n        return (\n          <div className=\"zone\">\n            <h2>{formatZone(zone as Raid)}</h2>\n            {groupedSelectedItems[zone].map((item) => (\n              <ItemRow\n                item={item}\n                onDelete={() => {\n                  const newItems = props.selected.filter(\n                    (i) => i.id != item.id\n                  );\n                  const isValid = validators.reduce(\n                    (valid: boolean, validator) =>\n                      valid && validator.isValid(newItems),\n                    true\n                  );\n\n                  props.onChangeSelection(newItems, isValid);\n                }}\n              />\n            ))}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n","import React from \"react\";\n\nexport const Header: React.FC = () => (\n  <div className=\"header\">\n    <div>\n      <div className=\"wordmark\">Mischief@Pagle</div>\n    </div>\n  </div>\n);\n","import React from \"react\";\nimport \"./styles/app.scss\";\nimport { Header } from \"./components\";\nimport { PriorityManagementPage } from \"./pages\";\n\nfunction App() {\n  return (\n    <div>\n      <Header />\n      <div className=\"page-wrap\">\n        <PriorityManagementPage />\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./app\";\n\nconsole.log(process.env.REACT_APP_API_ROOT);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}